  # --- ⚙️ Configure OSS Storage ---
  - name: Enable maintenance mode
    community.docker.docker_container_exec:
      container: "{{ nextcloud_container }}"
      command: php occ maintenance:mode --on

  - name: Set objectstore class to S3 (Aliyun OSS compatible)
    community.docker.docker_container_exec:
      container: "{{ nextcloud_container }}"
      command: php occ config:system:set objectstore class --value="\\OC\\Files\\ObjectStore\\S3"

  - name: Configure Aliyun OSS as primary storage
    community.docker.docker_container_exec:
      container: "{{ nextcloud_container }}"
      command: >
        php occ config:system:set objectstore arguments --value='{
          "bucket": "{{ oss_bucket }}",
          "autocreate": true,
          "key": "{{ oss_access_key }}",
          "secret": "{{ oss_secret_key }}",
          "region": "{{ oss_region }}",
          "hostname": "{{ oss_hostname }}",
          "port": 443,
          "use_ssl": true,
          "verify": false
        }' --type=json

  - name: Disable maintenance mode
    community.docker.docker_container_exec:
      container: "{{ nextcloud_container }}"
      command: php occ maintenance:mode --off